<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Работа с ролями сервера и базы данных</title>
        <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.5;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .definition {
            margin-bottom: 20px;
        }
        
        .term {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .description {
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Работа с ролями сервера</h1>
            <p class="subtitle">Работа с фиксированными ролями базы данных / Назначение пользовательских ролей базы данных</p>
        </header>
        
        <div class="content">
            <div class="lecture-goal">
                <h2>Цель лекции</h2>
                <p>Изучить систему ролевой безопасности в СУБД, понять разницу между ролями сервера и ролями базы данных, освоить методы назначения прав доступа.</p>
            </div>
            
            <h2>Пользователи и права доступа в БД</h2>
            <p>В первую очередь мы должны определиться зачем нам нужно разделение прав доступа в БД и какие "пользователи" в ней могут быть. Для этого разберём тему на примере банка.</p>
            
            <p>Представьте себе, что вы разрабатываете банковское приложение. В нем хранятся персональные данные клиентов, финансовые операции, информация о сотрудниках, а также конфиденциальные данные о работе самого банка. Чтобы защитить эту информацию от несанкционированного доступа и обеспечить ее целостность, необходима система управления правами доступа. Разные пользователи приложения должны иметь разные полномочия в зависимости от их роли.</p>
            
            <h3>Пример с тремя типами пользователей:</h3>
            
            <div class="user-example">
                <div class="user-card">
                    <h4>Администратор базы данных</h4>
                    <span class="role">Полный доступ</span>
                    <p><strong>В жизни:</strong> это IT сотрудник, который работает с базой данных.</p>
                    <p><strong>В базе данных:</strong> Этот пользователь обладает полными правами на управление базой данных. Он может создавать, удалять и редактировать таблицы, устанавливать права доступа для других пользователей, настраивать систему безопасности и выполнять другие административные задачи.</p>
                </div>
                
                <div class="user-card">
                    <h4>Диспетчер / личный менеджер</h4>
                    <span class="role">Ограниченный доступ</span>
                    <p><strong>В жизни:</strong> этот сотрудник звонит вам по телефону, чтобы предложить новую услугу / отвечает на ваши обращения в банк, подскажет вам о ваших операциях или подключенных услугах.</p>
                    <p><strong>В базе данных:</strong> У этого пользователя есть доступ к информации о клиентах, чтобы помогать им с операциями и решать возникающие вопросы. Он может просматривать историю операций, баланс счета, персональные данные клиента, но не может изменять их.</p>
                </div>
                
                <div class="user-card">
                    <h4>Супервайзер</h4>
                    <span class="role">Расширенный доступ</span>
                    <p><strong>В жизни:</strong> это руководитель личных менеджеров, он следит за их работой и даёт возможность изменять данные клиентов по их обращениям.</p>
                    <p><strong>В базе данных:</strong> У этого пользователя есть более расширенные права, чем у диспетчера. Он может просматривать информацию о клиентах, а также изменять их данные, например, адрес или контактную информацию. Кроме того, супервайзер имеет доступ к информации о сотрудниках, но не может редактировать их данные.</p>
                </div>
            </div>
            
            <h3>Пример: изменение данных клиента</h3>
            <ul>
                <li><strong>Диспетчер:</strong> Не имеет права изменять данные клиента. Он может только просматривать информацию.</li>
                <li><strong>Супервайзер:</strong> Имеет право изменять данные клиента, например, контактный телефон или адрес.</li>
                <li><strong>Администратор:</strong> Имеет полные права и может изменять любые данные клиента.</li>
            </ul>
            
            <div class="advantages">
                <h3>Почему такая система разделения прав необходима?</h3>
                <ol>
                    <li><strong>Безопасность:</strong> Разделение прав доступа предотвращает несанкционированный доступ к данным, минимизируя риски утечки информации. Например, диспетчер не может изменить финансовые данные клиентов, а супервайзер не может просматривать информацию о зарплате сотрудников.</li>
                    <li><strong>Контроль:</strong> Каждая операция в базе данных отслеживается и записывается в журнал аудита. Таким образом, администратор может видеть, кто и когда производил изменения в базе данных, что позволяет отслеживать действия пользователей и выявлять потенциальные угрозы.</li>
                    <li><strong>Эффективность:</strong> Разделение прав позволяет организовать работу с данными более эффективно. Например, диспетчер может быстро найти информацию о клиенте, не имея доступа к конфиденциальным данным, а супервайзер может оперативно изменить информацию о клиенте, не получая разрешения у администратора базы данных.</li>
                </ol>
            </div>
            
            <h2>1. Введение в ролевую безопасность</h2>
            <p>В современных СУБД (SQL Server, PostgreSQL, Oracle и др.) управление правами доступа осуществляется через роли. <strong>Роль</strong> — это именованный набор привилегий, который можно назначить пользователю или другой роли. Это упрощает администрирование: вместо назначения прав каждому пользователю отдельно, права назначаются ролям, а пользователи включаются в нужные роли.</p>
            
            <p>Существует два основных уровня ролей:</p>
            
            <div class="role-levels">
                <div class="role-level server">
                    <h3>Роли уровня сервера</h3>
                    <p>Управляют правами на уровне всего экземпляра СУБД.</p>
                </div>
                
                <div class="role-level database">
                    <h3>Роли уровня базы данных</h3>
                    <p>Управляют правами в рамках конкретной базы данных.</p>
                </div>
            </div>
            
            <h2>2. Роли уровня сервера</h2>
            <p>Эти роли предназначены для администрирования самого сервера баз данных. Они существуют вне конкретных баз данных.</p>
            
            <h3>Примеры фиксированных серверных ролей в SQL Server:</h3>
            <ul>
                <li><strong>sysadmin</strong> — выполняет любые действия на сервере. (Аналогична root в Linux).</li>
                <li><strong>serveradmin</strong> — может изменять конфигурации сервера и останавливать его.</li>
                <li><strong>securityadmin</strong> — управляет именами входа (логинами) на уровне сервера.</li>
                <li><strong>processadmin</strong> — может завершать процессы на сервере.</li>
                <li><strong>setupadmin</strong> — управляет связанными серверами и запускаемыми процедурами.</li>
                <li><strong>bulkadmin</strong> — может выполнять операции массового импорта данных (BULK INSERT).</li>
                <li><strong>diskadmin</strong> — управляет файлами дисков.</li>
                <li><strong>dbcreator</strong> — может создавать, изменять и удалять базы данных.</li>
                <li><strong>public</strong> — базовая роль, в которую по умолчанию входят все логины. Необходимо осторожно назначать права для этой роли.</li>
            </ul>
            
            <h3>Назначение серверной роли пользователю (логину):</h3>
            
            <div class="code-block">
                <span class="sql-comment">-- Синтаксис для SQL Server</span><br>
                ALTER SERVER ROLE [sysadmin] ADD MEMBER [ИмяЛогина];
            </div>
            
            <div class="code-block">
                <span class="sql-comment">-- Синтаксис для PostgreSQL (роли сервера часто являются ролями с правом входа)</span><br>
                CREATE ROLE admin_role WITH LOGIN SUPERUSER;
            </div>
            
            <div class="card">
                <p><strong>Важно:</strong> Наделение пользователя мощными серверными ролями (как sysadmin) должно быть строго обосновано.</p>
            </div>
            
            <h2>3. Роли уровня базы данных</h2>
            <p>Эти роли действуют в контексте конкретной базы данных и управляют правами на доступ к ее объектам: таблицам, представлениям, процедурам и т.д.</p>
            
            <h3>3.1. Фиксированные роли базы данных</h3>
            <p>Это предопределенные роли с уже настроенным набором привилегий. Их нельзя изменить.</p>
            
            <h3>Примеры фиксированных ролей базы данных в SQL Server:</h3>
            <ul>
                <li><strong>db_owner</strong> — имеет все права в базе данных. Может выполнять любые действия.</li>
                <li><strong>db_securityadmin</strong> — может управлять членством в ролях и правами доступа к объектам.</li>
                <li><strong>db_accessadmin</strong> — может добавлять или удалять доступ для логинов к текущей базе данных.</li>
                <li><strong>db_backupoperator</strong> — может создавать резервные копии базы данных.</li>
                <li><strong>db_ddladmin</strong> — может выполнять любые команды DDL (CREATE, ALTER, DROP) в базе данных.</li>
                <li><strong>db_datawriter</strong> — может добавлять, изменять и удалять данные во всех пользовательских таблицах.</li>
                <li><strong>db_datareader</strong> — может читать данные из всех пользовательских таблиц.</li>
                <li><strong>db_denydatawriter</strong> — не может изменять данные в таблицах.</li>
                <li><strong>db_denydatareader</strong> — не может читать данные из таблиц.</li>
                <li><strong>public</strong> — все пользователи базы данных являются членами этой роли. Права, назначенные роли public, получают все пользователи.</li>
            </ul>
            
            <h3>Назначение фиксированной роли базы данных пользователю:</h3>
            
            <div class="code-block">
                <span class="sql-comment">-- В SQL Server пользователь должен уже существовать в базе данных</span><br>
                EXEC sp_addrolemember 'db_datareader', 'ИмяПользователяВБД';
            </div>
            
            <div class="code-block">
                <span class="sql-comment">-- Или более современный синтаксис</span><br>
                ALTER ROLE [db_datareader] ADD MEMBER [ИмяПользователяВБД];
            </div>
            
            <h3>3.2. Пользовательские роли базы данных</h3>
            <p>Администратор может создавать собственные роли для реализации сложной политики безопасности, соответствующей бизнес-процессам.</p>
            
            <h3>Пример: В базе данных магазина можно создать роли:</h3>
            <ul>
                <li><strong>МенеджерПродаж</strong> — может просматривать и изменять заказы, но не может удалять их.</li>
                <li><strong>Бухгалтер</strong> — может просматривать все финансовые операции, но не может изменять товарный каталог.</li>
                <li><strong>Аналитик</strong> — имеет право только на чтение из всех таблиц.</li>
            </ul>
            
            <h3>Создание пользовательской роли и назначение прав:</h3>
            
            <div class="code-block">
                <span class="sql-comment">-- 1. Создать роль</span><br>
                CREATE ROLE [МенеджерПродаж];
            </div>
            
            <div class="code-block">
                <span class="sql-comment">-- 2. Назначить роли конкретные привилегии на конкретные объекты</span><br>
                GRANT SELECT, INSERT, UPDATE ON [dbo].[Orders] TO [МенеджерПродаж];<br>
                GRANT SELECT ON [dbo].[Customers] TO [МенеджерПродаж];<br>
                GRANT EXECUTE ON [schema_name].[ProcedureName] TO [МенеджерПродаж];
            </div>
            
            <div class="code-block">
                <span class="sql-comment">-- 3. Запретить определенные действия</span><br>
                DENY DELETE ON [dbo].[Orders] TO [МенеджерПродаж];
            </div>
            
            <div class="code-block">
                <span class="sql-comment">-- 4. Добавить пользователя в роль</span><br>
                ALTER ROLE [МенеджерПродаж] ADD MEMBER [Иван];
            </div>
            
            <h2>4. Иерархия прав доступа и принцип наименьших привилегий</h2>
            
            <div class="priority">
                <p>Права могут конфликтовать. Общее правило:</p>
                
                <div class="priority-item">
                    <div class="priority-marker deny">1</div>
                    <div>
                        <strong>Запрет (DENY) имеет наивысший приоритет.</strong> Он перекрывает любое разрешение (GRANT).
                    </div>
                </div>
                
                <div class="priority-item">
                    <div class="priority-marker grant">2</div>
                    <div>
                        <strong>Разрешение (GRANT)</strong> дает право на действие.
                    </div>
                </div>
                
                <div class="priority-item">
                    <div class="priority-marker revoke">3</div>
                    <div>
                        <strong>Лишение права (REVOKE)</strong> отменяет ранее выданное разрешение или запрет.
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>Принцип наименьших привилегий</h3>
                <p>Пользователю должна быть предоставлена ровно та степень доступа, которая необходима для выполнения его рабочих задач, и не более. Это ключевой принцип информационной безопасности.</p>
                
                <h3>Пример: Пользователю Иван нужно только читать данные из таблицы Products.</h3>
                <ul>
                    <li><strong>Правильно:</strong> Добавить его в роль db_datareader или создать роль только для чтения и выдать GRANT SELECT ON Products.</li>
                    <li><strong>Неправильно:</strong> Делать его db_owner или db_datawriter.</li>
                </ul>
            </div>
            
            <div class="recommendations">
                <h2>5. Практические рекомендации</h2>
                <ol>
                    <li><strong>Избегайте прямого назначения прав пользователям.</strong> Всегда используйте роли.</li>
                    <li><strong>Используйте встроенные фиксированные роли для стандартных задач</strong> администрирования (db_backupoperator, db_datareader).</li>
                    <li><strong>Создавайте собственные роли для реализации бизнес-логики и сложных требований</strong> безопасности.</li>
                    <li><strong>Регулярно проводите аудит прав доступа.</strong> Проверяйте, кто и к каким данным имеет доступ.</li>
                    <li><strong>Документируйте созданные роли и назначенные им права</strong> для упрощения дальнейшего сопровождения.</li>
                </ol>
            </div>
            
            <div class="card">
                <p>Правильное управление ролями — краеугольный камень безопасности и эффективного администрирования любой информационной системы, построенной на основе СУБД. Понимание разницы между серверными и базы данных ролями, а также владение инструментами их настройки является обязательным навыком для специалиста по сопровождению ИС.</p>
            </div>
        </div>
        
        <footer>
            <p>Лекция: Работа с ролями сервера и базы данных</p>
        </footer>
    </div>
</body>
</html>